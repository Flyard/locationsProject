import{a as m}from"./axios-bff3f665.js";import{_ as h,o as l,c as r,a as t,t as s,d as _,r as f,F as g,e as D,f as y}from"./index-33ca901a.js";const p="https://locations-project-back.onrender.com/locations",v={name:"LocationsCards",props:["_id","filmType","filmProducerName","endDate","filmName","district","sourcelocationId","filmDirectorName","address","startDate","year"],data(){return{showDetails:!1,editing:!1}},methods:{goEdit(){localStorage.setItem("locationId",this._id),console.log("added"),this.$router.push("/edit")},toogleDetails(){this.showDetails=!this.showDetails},async doDelete(){this.token=localStorage.getItem("token"),await m.delete(p+"/"+this._id,{headers:{Authorization:"Bearer "+this.token}}).then(i=>{alert("Deleted"),window.location.reload()}).catch(i=>{i.response.status===403&&alert("You are not authorized to do this action.")})}}},b={class:"card"},k={class:"card-body"},N={key:0,class:"card-details"},w={class:"button-align"};function I(i,o,e,u,n,d){return l(),r("div",b,[t("div",{class:"card-title",onClick:o[0]||(o[0]=c=>d.toogleDetails())},s(e.filmName),1),t("div",k,s(e.filmDirectorName),1),n.showDetails?(l(),r("div",N,[t("p",null,"id: "+s(e._id),1),t("p",null,"Type: "+s(e.filmType),1),t("p",null,"Producer: "+s(e.filmProducerName),1),t("p",null,"Year: "+s(e.year),1),t("p",null,"Start date: "+s(e.startDate),1),t("p",null,"End date: "+s(e.endDate),1),t("p",null,"Address: "+s(e.address),1),t("p",null,"District: "+s(e.district),1),t("p",null,"Source location ID: "+s(e.sourcelocationId),1),t("div",w,[t("button",{type:"button",class:"card-button",onClick:o[1]||(o[1]=c=>d.goEdit())},"Edit"),t("button",{type:"button",class:"card-button",onClick:o[2]||(o[2]=c=>d.doDelete())},"Delete")])])):_("",!0)])}const C=h(v,[["render",I]]);const L={name:"Locations",components:{LocationsCards:C},data(){return{token:"",index:0,locations:[],page:1,loading:!1}},created(){this.fetchData().then(i=>this.totalItems=i),window.addEventListener("scroll",this.handleScroll)},beforeDestroy(){window.removeEventListener("scroll",this.handleScroll)},methods:{logout(){try{localStorage.removeItem("token"),this.$router.push("/")}catch{console.log("error")}},async fetchData(){this.token=localStorage.getItem("token"),this.loading=!0;let i=20,o=0,e=[];for(;;){const u=`https://locations-project-back.onrender.com/locations?limit=${i}&offset=${o}`;await m.get(u,{headers:{Authorization:"Bearer "+this.token}}).then(n=>(e=e.concat(n.data),o+=i,n.data.totalItems)).catch(n=>{localStorage.getItem("token")===null&&this.$router.push("/login")}),this.locations=e,this.loading=!1}},handleScroll(){if(this.loading)return;document.documentElement.scrollHeight-window.scrollY===window.innerHeight&&this.locations.length<this.totalItems&&(this.page+=1,this.fetchData())}}},S={class:"big_container"},x={class:"first_container"},E=t("h1",{class:"title"},"All locations",-1),$={class:"navbar"},P={class:"cardContainer"},T={class:"second_container"},A={key:0,class:"loading"};function B(i,o,e,u,n,d){const c=f("LocationsCards");return l(),r("div",S,[t("div",x,[E,t("nav",$,[t("button",{type:"button",class:"button",onClick:o[0]||(o[0]=a=>this.$router.push("/add"))},"Add a location"),t("button",{type:"button",class:"button",onClick:o[1]||(o[1]=a=>d.logout())},"Logout")])]),t("div",P,[(l(!0),r(g,null,D(n.locations,a=>(l(),r("div",T,[y(c,{class:"locationCard",_id:a._id,filmType:a.filmType,filmProducerName:a.filmProducerName,endDate:a.endDate,filmName:a.filmName,district:a.district,sourcelocationId:a.sourcelocationId,filmDirectorName:a.filmDirectorName,address:a.address,startDate:a.startDate,year:a.year},null,8,["_id","filmType","filmProducerName","endDate","filmName","district","sourcelocationId","filmDirectorName","address","startDate","year"])]))),256))]),n.loading?(l(),r("p",A,"Loading...")):_("",!0)])}const Y=h(L,[["render",B]]);export{Y as default};
